<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Карта Франции</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
html, body, #map { height:100%; margin:0; padding:0; }
body { font-family: Arial, sans-serif; }
.coords { font-size:13px; color:#444; margin:4px 0; }
.hotels { margin:6px 0 0 16px; }
#form { display:none; position:absolute; top:10px; left:10px; background:white; padding:10px; border:1px solid #ccc; z-index:1000; width:300px; }
#form input, #form textarea { width:100%; margin-bottom:5px; }
#form button { margin-right:5px; }
#buttons { position:absolute; top:10px; right:10px; z-index:1000; background:white; padding:5px; border:1px solid #ccc; }
#buttons button { margin-right:5px; }
</style>
</head>
<body>

<div id="map"></div>

<div id="form">
  <label>Название:<br><input id="title" type="text"></label>
  <label>Ссылка Google Maps:<br><input id="link" type="text" placeholder="https://www.google.com/maps/..."></label>
  <label>Отели / описание:<br><textarea id="hotels" rows="4"></textarea></label>
  <button id="saveBtn">Сохранить</button>
  <button id="cancelBtn">Отмена</button>
</div>

<div id="buttons">
  <button id="exportBtn">Экспорт JSON</button>
  <input type="file" id="importFile" style="display:none;">
  <button id="importBtn">Импорт JSON</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map', { center: [46.7, 2.4], zoom: 6 });
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

const markersGroup = L.featureGroup().addTo(map);
let editingMarker = null;

const form = document.getElementById('form');
const titleInput = document.getElementById('title');
const linkInput = document.getElementById('link');
const hotelsInput = document.getElementById('hotels');
const saveBtn = document.getElementById('saveBtn');
const cancelBtn = document.getElementById('cancelBtn');

const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const importFile = document.getElementById('importFile');

// --- Встроенные маркеры (можно добавлять свои) ---
const initialMarkers = [
   {
    "lat": 46.1196013,
    "lng": 3.4234434,
    "title": "Питьевой источник: Source des Célestins",
    "googleLink": "https://www.google.com/maps/place/Source+des+C%C3%A9lestins/@46.1196013,3.4234434,17z/data=!3m1!4b1!4m6!3m5!1s0x47f6cd0826eda66f:0x653b95e14cb4214c!8m2!3d46.1196013!4d3.4234434!16s%2Fg%2F11g0g4v_3z?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Температура 22°, самый известный источник в Виши, низкая концентрации солей. Курс питьевого лечения водой назначают пациентам с заболеваниями печени, почек и желудка."
    ]
  },
  {
    "lat": 46.1258346,
    "lng": 3.4170022,
    "title": "Отель: Célestins Spa Thermal & Hôtel",
    "googleLink": "https://www.google.com/maps/place/C%C3%A9lestins+Spa+Thermal+%26+H%C3%B4tel/@46.1258346,3.4170022,17z/data=!4m21!1m11!3m10!1s0x47f6cd0c948550a1:0x3ac3c7af96d11cfa!2sC%C3%A9lestins+Spa+Thermal+%26+H%C3%B4tel!5m2!4m1!1i2!8m2!3d46.1258346!4d3.4170022!10e1!16s%2Fg%2F1tdf0q51!3m8!1s0x47f6cd0c948550a1:0x3ac3c7af96d11cfa!5m2!4m1!1i2!8m2!3d46.1258346!4d3.4170022!16s%2Fg%2F1tdf0q51?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Один из крупнейших SPA-центров Европы. Есть питьевые воды Vichy, бюветы + термальные купальни, ванны, спа. Пользуется популярностью при заболеваниях ЖКТ, печени, обмена веществ."
    ]
  },
  {
    "lat": 46.4008956,
    "lng": 6.593947,
    "title": "Санаторий: Les Thermes d’Évian",
    "googleLink": "https://www.google.com/maps/place/Les+Thermes+evian%C2%AE/@46.4008956,6.593947,17z/data=!3m1!4b1!4m6!3m5!1s0x478c235448c817c5:0x7420e59f3b2168fe!8m2!3d46.4008919!4d6.5965219!16s%2Fg%2F1tfghqjh?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Термальное лечение в Эвиане рекомендуется при заболеваниях пищеварительного тракта и нарушения обмена веществ"
    ]
  },
  {
    "lat": 46.3996771,
    "lng": 6.5914664,
    "title": "Питьевой источник: Source Cachat",
    "googleLink": "https://www.google.com/maps/place/Source+Cachat/@46.3996771,6.5914664,20.17z/data=!4m6!3m5!1s0x478c2354b94c18bf:0xefadbfb56cf929c1!8m2!3d46.3996984!4d6.5916597!16s%2Fg%2F11byp5s9p7?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Температура воды 11°. Богатая кальцием, магнием и бикарбонатом, вода способствует регуляции кислотно-щелочного баланса организма, способствует поддержанию водного баланса организма, улучшает пищеварение и помогает поддерживать нормальное кровяное давление."
    ]
  },
  {
    "lat": 46.1260975,
    "lng": 3.4192584,
    "title": "Бювет с разными источниками: Hall des Sources",
    "googleLink": "https://www.google.com/maps/place/Hall+des+Sources/@46.1260975,3.4192584,18z/data=!4m14!1m7!3m6!1s0x47f6cd0c394c39fd:0xffd98f1ead58568b!2sHall+des+Sources!8m2!3d46.1261508!4d3.4198956!16s%2Fg%2F11h_3t5rzh!3m5!1s0x47f6cd0c394c39fd:0xffd98f1ead58568b!8m2!3d46.1261508!4d3.4198956!16s%2Fg%2F11h_3t5rzh?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "5 источников разной температуры: Grande Grille (39°), Chomel (43°), Lucas (27°), Mesdames (17°), Hôpital (34°). Воды богаты сероводородом, фтором, диоксидом кремния (регенерация клеток). Используются для лечения пищеварительных и обменных заболеваний, укрепляют иммунитет и заживляют раны.",
      "примечание: Есть вход с городской улицы. Он свободный, но там можно получить доступ только к воде Селестин. Со стороны парка есть вход, открывающийся карточкой от номера гостиницы. Её программируют в отеле после посещения врача, когда тот пропишет схему приёма воды. В этом случае с этого входа будут доступны ещё воды помимо Célestins. Есть шанс попасть в эту часть и без карты: соседняя дверь с поручнями внутри открывается свободно наружу если её удастся приоткрыть."
    ]
  },
  {
    "lat": 46.1345584,
    "lng": 3.4458778,
    "title": "Питьевой источник: Source Mesdames",
    "googleLink": "https://www.google.com/maps/place/Source+mesdames/@46.1345584,3.4458778,20.97z/data=!4m15!1m8!3m7!1s0x47f6cce6674f8b21:0x74c97092b9724ba9!2sSource+Mesdames,+All%C3%A9e+Mesdames,+03300+Cusset!3b1!8m2!3d46.1345274!4d3.4458608!16s%2Fg%2F11b8td7c2d!3m5!1s0x47f6cdfe0ecbbd31:0x58806e0244f12237!8m2!3d46.1345023!4d3.4459097!16s%2Fg%2F11k6lm49gs?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Если не пустят в Hall des Sourse (большой бювет), то за источником Mesdames сюда. Обладает гидрокарбонатно-натриевым составом с высокой минерализацией, что помогает снижать(!) кислотность желудочного сока и улучшает микроциркуляцию крови. Кроме того, минералы и микроэлементы источника оказывают положительное воздействие на пищеварительный тракт, снижают мышечную усталость и способствуют общему восстановлению организма."
    ]
  },
  {
    "lat": 46.0826936,
    "lng": 3.4420899,
    "title": "Питьевой фонтан: Source Saint Ange",
    "googleLink": "https://www.google.com/maps/place/Fontaine+Source+Saint+Ange/@46.0826936,3.4420899,17z/data=!3m1!4b1!4m6!3m5!1s0x47f6cd004a76a757:0xc9b8da8abc0c294e!8m2!3d46.0826899!4d3.4446648!16s%2Fg%2F11xm1lz0j7?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Подробное описание отсутствует, \"самый обильный из холодных источников в Виши\""
    ]
  },
  {
    "lat": 42.5093764,
    "lng": 2.8202339,
    "title": "Cпа-курорт Thermes du Boulou-Maureillas",
    "googleLink": "https://www.google.com/maps/place/Thermes+du+Boulou-Maureillas/@42.5093764,2.8202339,15.19z/data=!4m6!3m5!1s0x12ba9e2f7a22f049:0x77b6ba8b88437de8!8m2!3d42.5090247!4d2.8272027!16s%2Fg%2F1td5b_q0?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Курорт Ле Булу исторически считается одним из лучших во Франции для лечения органов пищеварения, гепато-билиарной системы и восстановительной терапии. Воды гидрокарбонатные, хлоридные, кальциево-магниевые, газированные и холодные (16°C). Они богаты многими микроэлементами, включая медь. Ле-Булу — единственная натриево-карбонатная станция в Пиренеях. При питьевом лечении эти воды повышают тонус и сокращаемость гладкой мускулатуры кишечника, способствуют более обильной и чистой желчи."
    ]
  },
  {
    "lat": 42.5231406,
    "lng": 2.8258813,
    "title": "Музей воды: Maison de l'Eau et de la Méditerranée",
    "googleLink": "https://www.google.com/maps/place/Maison+de+l'Eau+et+de+la+M%C3%A9diterran%C3%A9e/@42.5231406,2.8258813,15.19z/data=!4m14!1m7!3m6!1s0x12ba9e2f7a22f049:0x77b6ba8b88437de8!2sThermes+du+Boulou-Maureillas!8m2!3d42.5090247!4d2.8272027!16s%2Fg%2F1td5b_q0!3m5!1s0x12ba9f72e0321a5f:0x76798a1f71c8169b!8m2!3d42.5245665!4d2.8339554!16s%2Fg%2F11fj9ph71c?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "В зоне отдыха вам будет предложено посмотреть три коротких видеоролика про особые свойства и преимущества термальных вод Ле-Булу:",
      "Чудодейственные воды",
      "История термального курорта Ле Булу",
      "Целебные воды"
    ]
  },
  {
    "lat": 46.3997842,
    "lng": 6.5925449,
    "title": "Питьевой источник: Source des Cordeliers",
    "googleLink": "https://www.google.com/maps/place/Source+des+Cordeliers/@46.3997842,6.5925449,20.08z/data=!4m16!1m9!3m8!1s0x478c231eb5f479ad:0xe072cb65d2e7ad78!2sSource+des+Cordeliers!8m2!3d46.3998334!4d6.5928651!9m1!1b1!16s%2Fg%2F11fkvp1dkm!3m5!1s0x478c231eb5f479ad:0xe072cb65d2e7ad78!8m2!3d46.3998334!4d6.5928651!16s%2Fg%2F11fkvp1dkm?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Источник с такой же водой что и у ближайшего Cachat, но людей меньше"
    ]
  },
  {
    "lat": 46.3942313,
    "lng": 6.5469453,
    "title": "Питьевой источник: Source Maxima",
    "googleLink": "https://www.google.com/maps/place/%D0%9F%D0%B0%D1%80%D0%BA+%D0%9C%D0%B0%D0%BA%D1%81%D0%B8%D0%BC%D0%B0/@46.3942313,6.5469453,17z/data=!4m14!1m7!3m6!1s0x478c3dff492b0779:0xf1dc9157acf455cd!2sSource+Maxima+(source+sulfureuse)!8m2!3d46.3942313!4d6.5469453!16s%2Fg%2F11r346cf93!3m5!1s0x478c3d045ad25285:0x2d97b2042967a0a1!8m2!3d46.3943675!4d6.5464962!16s%2Fg%2F11fk3sc1z6?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Щелочной источник, похожий на Эвианский, отличается мощным дебитом, много сероводорода."
    ]
  },
  {
    "lat": 46.3906909,
    "lng": 6.5384715,
    "title": "Питьевой источник: Source d'Eau Souriane (La buvette de farquenoud / Fontaine de Publier)",
    "googleLink": "https://www.google.com/maps/place/Source+d'Eau+Souriane+(La+buvette+de+farquenoud)/@46.3906909,6.5384715,17z/data=!3m1!4b1!4m6!3m5!1s0x478c3c613965c60d:0x85be4d6e0b572133!8m2!3d46.3906909!4d6.5384715!16s%2Fg%2F11dz_zkcwb?authuser=0&hl=ru&entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Красивое место, та же вода, что и из источника Cachat"
    ]
  },
  {
    "lat": 46.3693528,
    "lng": 6.4740402,
    "title": "Питьевой фонтан: CHAMPIGNON DE LA VERSOIE",
    "googleLink": "https://www.google.com/maps/place/CHAMPIGNON+DE+LA+VERSOIE/@46.3693528,6.4740402,19z/data=!3m1!4b1!4m6!3m5!1s0x478c3e619e12328b:0x1bb4abb21289e127!8m2!3d46.3693519!4d6.4746839!16s%2Fg%2F11_ylwmtc?authuser=0&hl=ru&entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Слабоминерализованная вода, богата бикарбонатами, кальцием и магнием. Применяется для лечения желудочно-кишечных заболеваний и обмена веществ. Рядом с термами есть ещё один фонтанчик."
    ]
  },
  {
    "lat": 46.3698266,
    "lng": 6.4728466,
    "title": "Санаторий: ValVital - Résidence hôtelière Villa Thermae Thonon-les-Bains",
    "googleLink": "https://www.google.com/maps/place/ValVital+-+R%C3%A9sidence+h%C3%B4teli%C3%A8re+Villa+Thermae+Thonon-les-Bains/@46.3698266,6.4728466,19z/data=!4m9!3m8!1s0x478c3fb24f2f3075:0xe77362eaf351be55!5m2!4m1!1i2!8m2!3d46.3699693!4d6.4729672!16s%2Fg%2F11s2jwrfdg?authuser=0&hl=ru&entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Термальное курортное лечение заболеваний пищеварительной системы и обмена веществ предназначено для людей, страдающих функциональными колопатиями, воспалительными колитами, функциональными расстройствами пищеварения и последствиями заболеваний печени"
    ]
  },
  {
    "lat": 45.64108143769799,
    "lng": 4.236546854402133,
    "title": "Термальные ванны: Thermes de Montrond-les-Bains",
    "googleLink": "https://www.google.com/maps/place/Baths+of+Montrond-les-Bains/@45.64108143769799,4.236546854402133,18z/data=!3m1!5s0x47f448dde51a7555:0xa239de6a4fbb3501!4m14!1m7!3m6!1s0x47f448ddda90931b:0x5c037676244ae97a!2sBaths+of+Montrond-les-Bains!8m2!3d45.6409914!4d4.2363591!16s%2Fg%2F11c5845rq7!3m5!1s0x47f448ddda90931b:0x5c037676244ae97a!8m2!3d45.6409914!4d4.2363591!16s%2Fg%2F11c5845rq7?authuser=0&hl=ru&entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Газированная вода, добываемая с глубины почти 500 метров, относится к типу горячих гидрокарбонатно-натриевых. Гармоничный состав (богата серой и магнием) и бактериологическая чистота воды делает её подходящей для лечения заболеваний пищеварительной системы. Богатая гидрокарбонатами и минералами, она известна своими терапевтическими свойствами: кислотно-щелочным и противовоспалительным. Добывается при температуре 24°C и доставляется при температуре 32°C после нагревания."
    ]
  },
  {
    "lat": 43.804547117063635,
    "lng": 0.431876439657401,
    "title": "Термальные ванны: Centre thermal de Castéra-Verduzan",
    "googleLink": "https://www.google.com/maps/place/Thermal+Center+of+Castera-Verduzan/@43.804547117063635,0.431876439657401z/data=!4m16!1m9!3m8!1s0x12aa27ecaba7bd8f:0x835bc780faaa11dc!2sThermal+Center+of+Castera-Verduzan!8m2!3d43.804431!4d0.4312649!9m1!1b1!16s%2Fg%2F11c1v04wbc!3m5!1s0x12aa27ecaba7bd8f:0x835bc780faaa11dc!8m2!3d43.804431!4d0.4312649!16s%2Fg%2F11c1v04wbc?authuser=0&hl=ru&entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Ванны используют воду богатую кальцием, сульфатами, серой и магнием, облегчая проблемы с пищеварением и способствует его улучшению. Также стимулирует работу печени, желчного пузыря и поджелудочной железы, улучшает функцию почек."
    ]
  },
  {
    "lat": 43.123066042840364,
    "lng": 0.30497790375148426,
    "title": "Термические ванны: Thermes de Capvern Les Bains",
    "googleLink": "https://www.google.com/maps/place/Thermes+de+Capvern+Les+Bains/@43.123066042840364,0.30497790375148426z/data=!4m6!3m5!1s0x12a84a712eeeeae1:0x5a101d7228d3687d!8m2!3d43.123038!4d0.3048804!16s%2Fg%2F11b6d211lp?authuser=0&hl=ru&entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",
    "hotels": [
      "Вода имеет гепатоцеллюлярное действие",
      "благодаря  содержанию сульфатов, кальция и магния, приводит к общей стимуляции как эндокринных, так и экзокринных функций печеночных клеток. Помогает при функциональных последствиях гепатита."
    ]
  }
];

// --- Извлечение координат из Google Maps ссылки ---
function getLatLngFromGoogleLink(url) {
  try {
    const matchAt = url.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/);
    if(matchAt) return {lat:parseFloat(matchAt[1]), lng:parseFloat(matchAt[2])};
    const matchQ = url.match(/[?&]q=(-?\d+\.\d+),(-?\d+\.\d+)/);
    if(matchQ) return {lat:parseFloat(matchQ[1]), lng:parseFloat(matchQ[2])};
    const matchPlace = url.match(/\/@(-?\d+\.\d+),(-?\d+\.\d+),/);
    if(matchPlace) return {lat:parseFloat(matchPlace[1]), lng:parseFloat(matchPlace[2])};
  } catch(e){ return null; }
  return null;
}

// --- Сохранение маркеров в localStorage ---
function saveMarkers() {
  const data = markersGroup.getLayers().map(marker => ({
    lat: marker.getLatLng().lat,
    lng: marker.getLatLng().lng,
    title: marker.options.title,
    googleLink: marker.options.googleLink,
    hotels: marker.options.hotels
  }));
  localStorage.setItem('myMapMarkers', JSON.stringify(data));
}

// --- Подстройка карты под все маркеры ---
function fitMapToMarkers() {
  const layers = markersGroup.getLayers();
  if(layers.length > 0){
    const bounds = L.latLngBounds(layers.map(m => m.getLatLng()));
    map.fitBounds(bounds, {padding:[50,50]});
  }
}

// --- Создание маркера ---
function createMarker(data, center=true) {
  const marker = L.marker([data.lat,data.lng]).addTo(markersGroup);
  marker.options.title = data.title;
  marker.options.googleLink = data.googleLink;
  marker.options.hotels = data.hotels;
  marker.bindPopup(`
    <strong>${data.title}</strong>
    <div class="coords">Широта: ${data.lat.toFixed(5)}, Долгота: ${data.lng.toFixed(5)}</div>
    ${data.hotels.length ? '<ul class="hotels">'+data.hotels.map(h=>`<li>${h}</li>`).join('')+'</ul>' : '<div class="small">Отели не указаны</div>'}
    <div><a href="${data.googleLink}" target="_blank">Открыть в Google Maps</a></div>
  `);

  marker.on('click',function(){
    editingMarker = marker;
    titleInput.value = marker.options.title;
    linkInput.value = marker.options.googleLink;
    hotelsInput.value = marker.options.hotels.join('\n');
    form.style.display='block';
  });

  if(center) fitMapToMarkers();
}

// --- Клик по карте для нового маркера ---
map.on('click', function(e){
  editingMarker = null;
  titleInput.value = '';
  linkInput.value = '';
  hotelsInput.value = '';
  form.style.display='block';
});

// --- Сохранение данных из формы ---
saveBtn.onclick = function(){
  const title = titleInput.value.trim();
  const link = linkInput.value.trim();
  const hotelsText = hotelsInput.value.trim();
  const hotels = hotelsText ? hotelsText.split("\n").map(h=>h.trim()).filter(Boolean) : [];

  if(!title || !link){ alert("Название и ссылка Google Maps обязательны"); return; }

  const coordsObj = getLatLngFromGoogleLink(link);
  if(!coordsObj){ alert("Не удалось извлечь координаты из ссылки!"); return; }
  const {lat,lng} = coordsObj;
  const data = {lat,lng,title,googleLink:link,hotels};

  if(editingMarker){
    editingMarker.setLatLng([lat,lng]);
    editingMarker.options.title = title;
    editingMarker.options.googleLink = link;
    editingMarker.options.hotels = hotels;
    editingMarker.bindPopup(`
      <strong>${title}</strong>
      <div class="coords">Широта: ${lat.toFixed(5)}, Долгота: ${lng.toFixed(5)}</div>
      ${hotels.length ? '<ul class="hotels">'+hotels.map(h=>`<li>${h}</li>`).join('')+'</ul>' : '<div class="small">Отели не указаны</div>'}
      <div><a href="${link}" target="_blank">Открыть в Google Maps</a></div>
    `).openPopup();
  } else createMarker(data);

  saveMarkers();
  form.style.display='none';
};

// --- Отмена формы ---
cancelBtn.onclick = function(){ form.style.display='none'; };

// --- Экспорт в JSON ---
exportBtn.onclick = function(){
  const data = markersGroup.getLayers().map(marker=>({
    lat: marker.getLatLng().lat,
    lng: marker.getLatLng().lng,
    title: marker.options.title,
    googleLink: marker.options.googleLink,
    hotels: marker.options.hotels
  }));
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='markers.json'; a.click();
};

// --- Импорт из JSON ---
importBtn.onclick = ()=>importFile.click();
importFile.onchange = e => {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    try{
      const data = JSON.parse(evt.target.result);
      markersGroup.clearLayers();
      data.forEach(item=>createMarker(item,false));
      saveMarkers();
      fitMapToMarkers();
    }catch(err){ alert("Ошибка при загрузке файла"); }
  };
  reader.readAsText(file);
};

// --- Загрузка встроенных маркеров ---
initialMarkers.forEach(m=>createMarker(m,false));
fitMapToMarkers();
</script>
</body>
</html>